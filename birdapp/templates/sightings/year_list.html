<!-- templates/sightings/year_list.html -->
 <!-- TODO: Rename as yearlist.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Bird Sightings {% if year %}{{ year }}{% endif %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
     
</head>
<body>
    

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h1>Bird Sightings {% if year %}for {{ year }}{% endif %}</h1>
                
                <!-- Year Filter Form -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form method="get" class="row g-3">
                            <div class="col-md-3">
                                <label for="year" class="form-label">Filter by Year:</label>
                                <select name="year" id="year" class="form-select" onchange="redirectToYear()">
                                    <option value="">All Years</option>
                                    {% for year_option in available_years %}
                                        <option value="{{ year_option.year }}" 
                                                {% if year_option.year == year|add:0 %}selected{% endif %}>
                                            {{ year_option.year }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">&nbsp;</label>
                                <button type="submit" class="btn btn-primary d-block" onclick="redirectToYear()">Filter</button>
                            </div>
                        </form>
                    </div>
                </div>
<script>
function redirectToYear() {
    const yearSelect = document.getElementById('year');
    const selectedYear = yearSelect.value;
    
    if (selectedYear) {
        window.location.href = '{% url "sighting_list" %}?year=' + selectedYear;
    } else {
        window.location.href = '{% url "sighting_list" %}';
    }
}
</script>
                <!-- Sightings Table -->
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Bird Species</th>
                                <th>Location</th>
                                <th>Count</th>
                                <th>Trip</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sighting in sightings %}
                                <tr>
                                    <td>{{ sighting.date_seen|date:"M d, Y" }}</td>
                                    <td>
                                        <strong>{{ sighting.bird.english_name }}</strong>
                                        {% if sighting.bird.latin_name %}
                                            <br><em class="text-muted">{{ sighting.bird.latin_name }}</em>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ sighting.location.name }}
                                        {% if sighting.location.location_name %}
                                            <br><small class="text-muted">{{ sighting.location.location_name }}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ sighting.count }}</span>
                                    </td>
                                    <td>
                                        {% if sighting.trip %}
                                            <a href="{% url 'trip_detail' sighting.trip.pk %}">
                                                {{ sighting.trip.name }}
                                            </a>
                                        {% else %}
                                            <em class="text-muted">No trip</em>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if sighting.notes %}
                                            {{ sighting.notes|truncatewords:15 }}
                                        {% else %}
                                            <em class="text-muted">No notes</em>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="6" class="text-center text-muted">
                                        No sightings found {% if year %}for {{ year }}{% endif %}.
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination (if using paginated view) -->
                {% if is_paginated %}
                    <nav aria-label="Sightings pagination">
                        <ul class="pagination justify-content-center">
                            {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if year %}&year={{ year }}{% endif %}">Previous</a>
                                </li>
                            {% endif %}
                            
                            {% for page_num in page_obj.paginator.page_range %}
                                {% if page_num == page_obj.number %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ page_num }}</span>
                                    </li>
                                {% elif page_num > page_obj.number|add:'-3' and page_num < page_obj.number|add:'3' %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_num }}{% if year %}&year={{ year }}{% endif %}">{{ page_num }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if year %}&year={{ year }}{% endif %}">Next</a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                {% endif %}
                
                <!-- Summary Info -->
                {% if year %}
                    <div class="alert alert-info mt-4">
                        <strong>{{ year }} Summary:</strong> 
                        {{ sightings|length }} sighting{{ sightings|length|pluralize }} found
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>